/*  jUri v0.3
    Mini-javascript library for handling url functions
    jUri by Enric Florit is licensed under a Creative Commons Attribution-ShareAlike 3.0 Unported License.
    You can read the license at http://creativecommons.org/licenses/by-sa/3.0/
    
    Email me:
    efz1005[at]gmail[dot]com */

var jUri=function(a){if(!a.console){var b=a.opera?a.opera.postError:alert;a.console={log:function(a){b(a)}};a.console.error=a.console.warn=a.console.debug=a.console.log}var c=a.navigator,d=c.appCodeName,e=c.appName,f=c.appVersion,g=c.language,h=c.mimeTypes,i=c.platform,j=c.plugins,k=c.userAgent;a.jUriReady=function(b){if(!document.body||!a.jUri){return setTimeout("window.jUriReady("+b+")",1)}b()};(function(){jUriReady(function(){var a=document.getElementsByTagName("a");for(var b=0,c=a.length;b<c;b++){var d=a[b],e=d.getAttribute("data-after");if(e){jUri.fn.addEvent(d,"click",function(a){a.preventDefault();var b=this.href,c=this.getAttribute("data-after");jUri.redirect(b,c)})}}})})();(function(){jUriReady(function(){var a=document.getElementsByTagName("*");for(var b=0,c=a.length;b<c;b++){var d=a[b],e=d.getAttribute("data-hash"),f=d.getAttribute("data-name");if(e||e==""){jUri.fn.addEvent(d,"click",function(a){var b=this.getAttribute("data-hash");jUri.hash(b)})}if(f&&!jUri.anchorExists(f)){var g=document.createElement("a");g.name=f;d.parentNode.insertBefore(g,d)}}jUri.anchorsCreated=true})})();jUriReady(function(){if(jUri.anchorExists(jUri.hash())){var b=jUri.fn.getAnchor(jUri.hash()),c=0;if(b&&b.offsetParent){do{c+=b.offsetTop}while(b=b.offsetParent)}a.scrollTo(0,c)}});return{host:function(){return a.location.host},hostname:function(){return a.location.hostname},href:function(){return a.location.href},pathname:function(){return a.location.pathname},port:function(){return a.location.port},protocol:function(){return a.location.protocol.replace(/:$/,"")},get:function(b){var c,d,e={};if(b&&b!==""){c=(b+"").replace(/^(.*?)\?/,"").split("&");for(d in c){var f=c[d].split("=");e[f[0]]=f[1]}}else{var g=a.location.search,h=g.replace(/^\?/,""),c=h.split("&");for(d in c){var f=c[d].split("=");e[f[0]]=f[1]}}return e},navigator:navigator,appCodeName:d,appName:e,appVersion:f,language:g,mimeTypes:h,platform:i,plugins:j,userAgent:k,set:function(a,b,c){if(history.pushState){if(!c)c=true;if(typeof a=="string"){history.pushState({},"",a)}else{var d=a.data||{},e=a.title||"",f=a.url||"";this.title(e);if(c){history.pushState(d,e,f)}else{history.replaceState(d,e,f)}}}else if(b&&typeof b=="function"){b()}},back:function(b,c){try{a.history.back(b)}catch(d){if(c)c()}},title:function(a,b){if(typeof a=="string"){try{document.getElementsByTagName("title")[0].innerHTML=a.replace("<","<").replace(">",">").replace(" & "," & ")}catch(c){document.title=a}}else if(typeof a=="object"){if(!b)b=1500;jUri.fx.changeTitle.init(a,b)}return{stop:function(a){jUri.fx.changeTitle.stop();jUri.title(a)}}},hash:function(b,c){if(b&&b instanceof RegExp){if(a.location.hash.replace(/^#/,"").match(b)){c?c():false;return true}else{return false}}else if(b||b==""){a.location.hash=b;return b}else{return a.location.hash.replace(/^#/,"")}},hashchange:function(b){if(!document.body){return setTimeout("jUri.hashchange("+b+")",1)}var c=0;if(typeof a.pageYOffset=="number"){c=a.pageYOffset}else if(document.body.scrollTop){c=document.body.scrollTop}else if(document.documentElement.scrollTop){c=document.documentElement.scrollTop}this.fn.checkhash(this.hash(),c,b)},urlchange:function(a,b){if(!document.body){return setTimeout("jUri.urlchange("+a+", "+b+")",1)}this.fn.checkurl(this.href(),a,+b)},isHTTP:function(a){if(this.protocol.match(/^http$/)){a?a():false;return true}else{return false}},isHTTPS:function(a){if(this.protocol.match(/^https$/)){a?a():false;return true}else{return false}},parseAsGet:function(b){var c=(b+"").replace(/^(.*?)\?/,"").split("&"),d={};for(var e in c){var f=c[e].split("=");d[f[0]]=f[1]}a.console.warn("jUri.parseAsGet(str) is deprecated, use jUri.get(str) instead");return d},redirect:function(b,c){if(c&&c%1===0){setTimeout("window.location.href='"+b+"'",c)}else{a.location.href=b}},reload:function(b){if(b&&b%1===0){setTimeout("window.location.reload(true);",b)}else{a.location.reload(true)}},isFile:function(a){if(this.pathname.match(/\.(html|htm|php|phtml|asp|shtml|cgi|jsp|pl)$/i)){a?a():false;return true}else{return false}},anchorExists:function(a,b){var c=this.fn.getAnchor(a);if(c){b?b(c):false;return true}return false},anchorsCreated:false,animateAnchorLinks:function(a,b){if(!document.body||!jUri.anchorsCreated){return setTimeout('jUri.animateAnchorLinks("'+a+'", '+b+")",1)}if(typeof a=="boolean"){a="*";b=a}if(typeof b!="boolean"){b=true}var c=[],d=[],e=document.getElementsByTagName("a");if(!a||typeof a=="undefined"||a==="undefined"||a=="*"){for(var f in e){if(e[f].name&&e[f].name!=""){c.push(e[f].name)}}}else{var g=a.replace(/\s/gim,"").split(","),h;for(var f in g){h=g[f];c.push(this.fn.getAnchor(h).name)}}for(var i in c){for(var f in e){if(e[f].href&&e[f].href!=""&&e[f].href.match("#"+c[i]+"$")){d.push(e[f])}else if(e[f].href&&e[f].href.match(/#$/)){d.push(e[f])}}}d=this.fn.removeDuplicated(d);for(var i in d){jUri.fn.addEvent(d[i],"click",function(a){a.preventDefault();var c=this.href.split("#")[1];jUri.fn.gotoAnchor(c,function(){if(b==true)jUri.hash(c)})})}},encode:function(a){return encodeURIComponent(a)},fn:{checkhash:function(b,c,d){if(jUri.hash()!=b){d(new hashChangeEvent(b,jUri.hash(),c));var c=0;if(typeof a.pageYOffset=="number"){scroll=a.pageYOffset}else if(document.body.scrollTop){scroll=document.body.scrollTop}else if(document.documentElement.scrollTop){scroll=document.documentElement.scrollTop}}setTimeout('jUri.fn.checkhash("'+jUri.hash()+'", '+c+", "+d+")",1)},checkurl:function(a,b,c){if(jUri.href()!=a){if(!c){if(jUri.href().split("#")[0]==a.split("#")[0]){return setTimeout('jUri.fn.checkurl("'+jUri.href()+'", '+b+"                                , "+c+")",1)}}b(new urlChangeEvent(a,jUri.href()))}setTimeout('jUri.fn.checkurl("'+jUri.href()+'", '+b+"                                , "+c+")",1)},pageScroll:function(a,b){if(!document.body){return setTimeout("jUri.fn.pageScroll("+a+")",1)}jUri.fx.scroller.scrollTo(a,b)},getAnchor:function(a){if(!document.body){return setTimeout("jUri.fn.getAnchor("+a+")",1)}if(!a){return null}if(a.match(/^#/))a=a.replace(/^#/,"");var b=document.getElementsByTagName("a");for(var c in b){element=b[c];if(element.name&&element.name.replace(/^#/,"")===a){return element}}return null},gotoAnchor:function(a,b){var c=jUri.fn.getAnchor(a),d=0;if(c&&c.offsetParent){do{d+=c.offsetTop}while(c=c.offsetParent)}jUri.fn.pageScroll(d,b)},removeDuplicated:function(a,b){var c=new Array;if(typeof b=="undefined"){a:for(var d in a){for(var e in c){if(c[e]==a[d])continue a}c[c.length]=a[d]}}else{a:for(var d in a){for(var e in c){if(c[e][b]==a[d][b])continue a}c[c.length]=a[d]}}return c},addEvent:function(){if(document.addEventListener){return function(b,c,d){if(b&&b.nodeName||b===a){b.addEventListener(c,d,false)}else if(b&&b.length){for(var e=0;e<b.length;e++){jUri.fn.addEvent(b[e],c,d)}}}}else{return function(b,c,d){if(b&&b.nodeName||b===a){b.attachEvent("on"+c,function(){return d.call(b,a.event)})}else if(b&&b.length){for(var e=0;e<b.length;e++){jUri.fn.addEvent(b[e],c,d)}}}}}()},fx:{scroller:{stepIncrement:20,stepDelay:1,limit:6e3,running:false,nextStep:null,killTimeout:null,finalPoint:null,callback:null,scrollStep:function(b,c,d){var e=jUri.fx.scroller.stepIncrement,f=jUri.fx.scroller.running;if(!f||d&&b>=c||!d&&b<=c){jUri.fx.scroller.killScroll();return}if(d&&b>=c-2*e||!d&&b<=c-2*e){e=e*.55}a.scrollTo(0,b);jUri.fx.scroller.nextStep=jUri.fx.scroller.callNext(+b+e,c,d);jUri.fx.scroller.stepIncrement=e;a.setTimeout(jUri.fx.scroller.nextStep,jUri.fx.scroller.stepDelay)},callNext:function(a,b,c){return function(){jUri.fx.scroller.scrollStep(a,b,c)}},scrollTo:function(b,c){if(jUri.fx.scroller.running)return false;jUri.fx.scroller.running=true;jUri.fx.scroller.callback=c;jUri.fx.scroller.finalPoint=b;var d=document.all?document.body.scrollTop:a.pageYOffset,e=true,f=jUri.fx.scroller.stepIncrement;if(d==b){jUri.fx.scroller.killScroll()}if(d>b){f*=-1;e=false}jUri.fx.scroller.killTimeout=a.setTimeout(jUri.fx.scroller.killScroll,jUri.fx.scroller.limit);jUri.fx.scroller.stepIncrement=f;jUri.fx.scroller.scrollStep(d+f,b,e)},killScroll:function(){a.clearTimeout(jUri.fx.scroller.killTimeout);jUri.fx.scroller.running=false;jUri.fx.scroller.stepIncrement=20;a.scrollTo(0,jUri.fx.scroller.finalPoint);jUri.fx.scroller.finalPoint=null;typeof jUri.fx.scroller.callback=="function"?jUri.fx.scroller.callback():false;jUri.fx.scroller.callback=null}},changeTitle:{active:false,obj:[],current:0,timeNext:1500,timeOut:null,init:function(a,b){if(jUri.fx.changeTitle.active)return false;jUri.fx.changeTitle.active=true;jUri.fx.changeTitle.obj=a;jUri.fx.changeTitle.timeNext=b;jUri.fx.changeTitle.callNext()},callNext:function(){var a=jUri.fx.changeTitle.current,b=jUri.fx.changeTitle.obj,c=jUri.fx.changeTitle.timeNext;if(b[a]){jUri.title(b[a]);jUri.fx.changeTitle.current=a+1}else{jUri.title(b[0]);jUri.fx.changeTitle.current=0}jUri.fx.changeTitle.timeOut=setTimeout(jUri.fx.changeTitle.callNext,c)},stop:function(){jUri.fx.changeTitle.active=false;jUri.fx.changeTitle.obj=false;jUri.fx.changeTitle.current=false;jUri.fx.changeTitle.timeNext=1500;a.clearTimeout(jUri.fx.changeTitle.timeOut)}}},log:function(a){console.log(a)},debug:function(a){console.debug(a)},warn:function(a){console.warn(a)},error:function(a){console.error(a)},"short":function(b){a[b]=jUri}}}(window),hashChangeEvent=function(a,b){this.oldHash=a||"#";this.newHash=b||"#";this.newLoc=window.location};urlChangeEvent=function(a,b){this.oldUrl=a||"#";this.newUrl=b||"#";this.newLoc=window.location};window.jUri=jUri